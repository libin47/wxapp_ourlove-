(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2179:function(e,n,i){Promise.resolve().then(i.bind(i,8836))},8836:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return f}});var t=i(7437),s=i(345),o=i.n(s),r=i(2265),c=i(4491),a=i(2649),l=i(8470);async function d(e,n,i){let t=await fetch(a.Y+"/coc_group_add_pc",{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({user:n,group:i,data:e})}),s=await t.json();return console.log(s),s.ok}async function u(e,n){let i=await fetch(a.Y+"/coc_group_add_tem",{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({group:n,data:e})}),t=await i.json();return console.log(t),t.ok}async function h(e,n){let i=await fetch(a.Y+"/coc_group_del_tem",{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({group:n,card_id:e})});return(await i.json()).ok}async function m(e,n){let i=await fetch(a.Y+"/coc_group_update",{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({card_id:n,data:e})});return(await i.json()).ok}function x(e){let{group:n,user:i,pcid:s,data:r}=e,a=function(e){let t=r[e];console.log("import self:",s),console.log("import data:",t),s?m(t,s).then(e=>{e&&c.u_.alert({content:"已成功提交！",onConfirm(){window.location.reload()}})}):d(t,i,n).then(e=>{e&&c.u_.alert({content:"已成功提交！",onConfirm(){window.location.reload()}})})};return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:o().cardbg,children:[(0,t.jsx)("div",{children:"我的角色卡"}),r.map((e,n)=>(0,t.jsxs)("div",{className:o().onecard,style:{backgroundColor:e.group?"lightgoldenrodyellow":"white"},children:[(0,t.jsxs)("div",{className:o().cardLeft,children:[e.group?(0,t.jsxs)("div",{children:["来自群：",e.group]}):(0,t.jsx)(t.Fragment,{}),(0,t.jsxs)("div",{children:["[",e.info.time?e.info.time:"年代未知"," / ",e.info.wherelive?e.info.wherelive:"居住地未知","]"]}),(0,t.jsxs)("div",{children:["女"===e.info.sex?"♀️":"♂️",e.name," - ",e["职业"]]})]}),(0,t.jsx)("div",{className:o().cardRight,children:(0,t.jsx)(c.zx,{color:"success",onClick:()=>a(n),children:"导入"})})]},n))]})})}function p(e){let{group:n,user:i,pcid:s}=e,[l,u]=(0,r.useState)({group:[],admin:[]}),h=function(e){s?m(e,s).then(e=>{e&&c.u_.alert({content:"已成功提交！",onConfirm(){window.location.reload()}})}):d(e,i,n).then(e=>{e&&c.u_.alert({content:"已成功提交！",onConfirm(){window.location.reload()}})})},x=async e=>{let n=await fetch(a.Y+"/coc_group_get_tem",{method:"post",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({group:e})});u((await n.json()).data)};return(0,r.useEffect)(()=>{x(n)},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:o().cardbg2,children:[(0,t.jsx)("div",{children:"COC7th预设角色卡"}),l.admin.length>0?l.admin.map((e,n)=>(0,t.jsxs)("div",{className:o().onecard,children:[(0,t.jsxs)("div",{className:o().cardLeft,children:[(0,t.jsxs)("div",{children:["[",e.info.time?e.info.time:"年代未知"," / ",e.info.wherelive?e.info.wherelive:"居住地未知","]"]}),(0,t.jsxs)("div",{children:["女"===e.info.sex?"♀️":"♂️",e.name," - ",e["职业"]]})]}),(0,t.jsx)("div",{className:o().cardRight,children:(0,t.jsx)(c.zx,{color:"success",onClick:()=>h(e),children:"导入"})})]},e)):(0,t.jsx)("div",{className:o().onecard,children:"暂无模板卡"}),(0,t.jsx)("div",{style:{paddingTop:"32px"},children:"本群预设角色卡"}),l.group.length>0?l.group.map((e,n)=>(0,t.jsxs)("div",{className:o().onecard,children:[(0,t.jsxs)("div",{className:o().cardLeft,children:[(0,t.jsxs)("div",{children:["[",e.info.time?e.info.time:"年代未知"," / ",e.info.wherelive?e.info.wherelive:"居住地未知","]"]}),(0,t.jsxs)("div",{children:["女"===e.info.sex?"♀️":"♂️",e.name," - ",e["职业"]]})]}),(0,t.jsx)("div",{className:o().cardRight,children:(0,t.jsx)(c.zx,{color:"success",onClick:()=>h(e),children:"导入"})})]},e)):(0,t.jsx)("div",{className:o().onecard,children:"暂无模板卡"})]})})}function g(e){let{group:n,pointAtt:i,attTime:s}=e,[d,x]=(0,r.useState)({group:[],admin:[]}),[p,g]=(0,r.useState)(""),[f,j]=(0,r.useState)(!1),v=async e=>{let n=await fetch(a.Y+"/coc_group_get_tem",{method:"post",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({group:e})});x((await n.json()).data)};(0,r.useEffect)(()=>{v(n)},[]);let _=e=>{c.Vq.confirm({content:"确认删除？",onConfirm:async()=>{h(e,n).then(e=>{e&&(c.FN.show({icon:"success",content:"删除成功",position:"bottom"}),v(n))})}})};return(0,t.jsx)(t.Fragment,{children:f?(0,t.jsx)(l.Z,{pointatt:i,atttime:s,pcid:"",completeFun:e=>{u(e,n).then(e=>{e&&c.u_.alert({content:"已成功提交！",onConfirm(){v(n),j(!1)}})})}}):p?(0,t.jsx)(l.Z,{pointatt:i,atttime:s,pcid:p,completeFun:e=>{m(e,p).then(e=>{e&&c.u_.alert({content:"已成功提交！",onConfirm(){g(""),v(n)}})})}}):(0,t.jsx)(function(){return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{className:o().mainbg,children:(0,t.jsxs)("div",{className:o().cardbg2,children:[(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",fontSize:"22px"},children:"群模板卡管理"}),d.group.length>0?d.group.map((e,n)=>(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:o().onecard,children:[(0,t.jsxs)("div",{className:o().cardLeft,children:[(0,t.jsxs)("div",{children:["[",e.info.time?e.info.time:"年代未知"," / ",e.info.wherelive?e.info.wherelive:"居住地未知","]"]}),(0,t.jsxs)("div",{children:["女"===e.info.sex?"♀️":"♂️",e.name," - ",e["职业"]]})]}),(0,t.jsxs)("div",{className:o().cardRight,children:[(0,t.jsx)(c.zx,{color:"success",onClick:()=>g(e._id),children:"编辑"}),(0,t.jsx)(c.zx,{color:"danger",onClick:()=>_(e._id),style:{marginLeft:8},children:"删除"})]})]},e)})):(0,t.jsx)("div",{className:o().onecard,children:"暂无模板卡，点击下面按钮创建"}),(0,t.jsx)(c.zx,{block:!0,color:"primary",onClick:()=>j(!0),style:{marginTop:16},children:"新增"}),(0,t.jsx)(c.zx,{block:!0,color:"warning",onClick:()=>window.location.reload(),style:{marginTop:8},children:"返回"})]})})})},{})})}function f(){let[e,n]=(0,r.useState)(500),[i,s]=(0,r.useState)(5),[u,h]=(0,r.useState)(""),[f,j]=(0,r.useState)(""),[v,_]=(0,r.useState)(!1),[w,y]=(0,r.useState)(!1),[N,C]=(0,r.useState)(!1),[k,T]=(0,r.useState)(!1),[S,b]=(0,r.useState)(),F=async e=>{let n=e.group,i=e.user,t=await fetch(a.Y+"/coc_group_get_user",{method:"post",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({user:i,group:n})}),s=(await t.json()).data;0===s.user.length&&0===s.user_group.length||b(s)},z=async e=>{let i=e.group,t=await fetch(a.Y+"/coc_group_config?group="+i,{method:"get",headers:{"Content-Type":"text/plain;charset=UTF-8"}}),o=(await t.json()).data,r=+o.point?+o.point:500;s(+o.dicetime?+o.dicetime:5),n(r)};(0,r.useEffect)(()=>{let e=window.location.search.split("?")[1];var n=e?e.split("&"):[],i={};for(let e=0;e<n.length;e++){let t=n[e].split("=");i[t[0]]=t[1]}F(i),z(i),j(i.group),h(i.user)},[]);let O=e=>{d(e,u,f).then(e=>{c.u_.alert({content:"已成功提交！",onConfirm(){window.location.reload()}})})},U=e=>{m(e,null==S?void 0:S.user_group._id).then(e=>{e&&c.u_.alert({content:"已成功提交！",onConfirm(){_(!1),F({group:f})}})})};function Y(){return(0,t.jsxs)("div",{className:o().mainbg,children:[(0,t.jsx)(x,{group:f,user:u,pcid:null==S?void 0:S.user_group._id,data:S?S.user:[]}),(0,t.jsxs)("div",{className:o().cardbg,children:[(0,t.jsx)("div",{children:"本群我的角色卡"}),(null==S?void 0:S.user_group.name)?(0,t.jsxs)("div",{className:o().onecard,children:[(0,t.jsxs)("div",{className:o().cardLeft,children:[(0,t.jsxs)("div",{children:["[",(null==S?void 0:S.user_group.info.time)?null==S?void 0:S.user_group.info.time:"年代未知"," / ",(null==S?void 0:S.user_group.info.wherelive)?null==S?void 0:S.user_group.info.wherelive:"居住地未知","]"]}),(0,t.jsxs)("div",{children:[(null==S?void 0:S.user_group.info.sex)==="女"?"♀️":"♂️",null==S?void 0:S.user_group.name," - ",null==S?void 0:S.user_group["职业"]," "]})]}),(0,t.jsx)("div",{className:o().cardRight,children:(0,t.jsx)(c.zx,{color:"success",onClick:()=>{_(!0)},children:"编辑"})})]}):(0,t.jsx)(t.Fragment,{})]}),(0,t.jsx)("div",{children:(0,t.jsx)(c.zx,{block:!0,color:"success",size:"large",onClick:()=>{y(!0)},children:"新建角色卡"})}),(0,t.jsx)("div",{children:(0,t.jsx)(c.zx,{block:!0,color:"success",size:"large",onClick:()=>{C(!0)},style:{marginTop:16},children:"导入预设卡"})})]})}return(0,t.jsx)(t.Fragment,{children:k?(0,t.jsx)(g,{group:f,pointAtt:e,attTime:i}):N?(0,t.jsx)(function(){return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:o().mainbg2,children:[(0,t.jsx)(p,{group:f,user:u,pcid:null==S?void 0:S.user_group._id}),(0,t.jsx)("div",{children:(0,t.jsx)(c.zx,{block:!0,color:"success",size:"large",onClick:()=>{C(!1)},style:{marginTop:32},children:"返回"})}),(0,t.jsxs)("div",{className:o().newtemtext,children:[" ",(0,t.jsx)("div",{onClick:()=>{T(!0)},children:"模板管理"})," "]})]})})},{}):(0,t.jsx)(function(){return(0,t.jsx)(t.Fragment,{children:w?(0,t.jsx)(l.Z,{pointatt:e,atttime:i,pcid:"",completeFun:O}):v?(0,t.jsx)(l.Z,{pointatt:e,atttime:i,pcid:null==S?void 0:S.user_group._id,completeFun:U}):(0,t.jsx)(Y,{})})},{})})}}},function(e){e.O(0,[740,491,470,971,69,744],function(){return e(e.s=2179)}),_N_E=e.O()}]);